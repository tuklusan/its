	TITLE LPT FOR TECO6

RELOCA

LPTCHN=UTCCHN"
LPTBSZ=1000

LPTS:	MOVEI A",40
PILPT":	PUSH P",A
	CAIN A,13
	JRST L171
	CAIN A,11
	JRST LPTTAB
	CAIE A,12
	CAIN A,14
	JRST LPC
	CAIGE A,140
	JRST L121
	CAILE A,173
	CAIN A,177
	JRST POPRET
	MOVEI A,"$
L121:	SETOM PCL
	CAIE A,15
	AOSA LINEPOS
	SETZM LINEPOS
L125:	CAIN A,12
	AOS LINE
	CAIN A,14
	SETZM LINE
	CAIL A,40
	JRST L144
	CAIL A,11
	CAILE A,15
	AOSA LINEPOS
	JRST L144
	MOVEI A,"^
	PUSH P,[143]
	PUSH P,-1(P)
	JRST L144
	TRO A,100
L144:	SUBI A,40
L145:	SKIPG LPTCC
	JRST L145
	IDPB A,LPTIP
	HRRZ A,LPTIP
	CAIN A,LPTBE-1
	MOVEI A,LPTBO
	HRRM A,LPTIP
	SOS LPTCC
	CONSO LPT,7
	CONO LPT,LPTCHN
POPRET:	POP P,A
	POPJ P,

LPTWAT":
	MOVE A,LPTCC
	CAIE A,5*LPTBSZ-5
	JRST LPTWAT
	POPJ P,

LPTTAB:	PUSHJ P,LPTS
	LDB A,[(300)LINEPOS]
	JUMPN A,LPTTAB
	JRST POPRET
L171:	PUSH P,LINEPOS
	SETZM LINEPOS
L173:	MOVEI A,12
	PUSHJ P,PILPT
	LDB A,[(300)LINE]
	JUMPN A,L173
	POP P,LINEPOS
	MOVEI A,12
	PUSHJ P,PILPT
	JRST POPRET

LPC:	PUSH P,LINEPOS
	MOVEI A,15
	AOSN PCL
	SKIPE LINEPOS
	PUSHJ P,PILPT
L210:	SOSGE (P)
	JRST LPC2
	PUSHJ P,LPTS
	JRST L210
LPC2:	POP P,A
	MOVE A,(P)
	JRST L125

LPTCC:	LPTBSZ*5-5
LINEPOS:	0
LINE:	0
PCL:	0
LPTIP:	700,,LPTBO-1
LPTOP:	700,,LPTBO-1

LPTCN:	CAIN A,<15-40>&177
	JRST LPTCR	;CRR
	CAIN A,<12-40>&177
	MOVEI A,400	;LINE FEED
	CAIN A,<14-40>&177
	MOVEI A,401	;FORM FEED
	JRST LPTCN1

LPTCR:	CONO LPT,10+LPTCHN	;PRINT LINE
	JRST L251

LPTBRK":
	CONSZ LPT,7
	CONSZ LPT,10
	JRST LPTRTN"
	PUSH P,A
LPENT1:	MOVEI A,5*LPTBSZ-5
	CAMG A,LPTCC
	JRST LPTSTP
	ILDB A,LPTOP
	TRNE A,100
	JRST LPTCN
LPTCN1:	DATAO LPT,A	;OUTPUT CHARACTER
L251:	HRRZ A,LPTOP	;LOAD OUTPUT POINTER
	CAIN A,LPTBE-1	;SKIP IF CURRENT PNTR = END OF BUFFER
	MOVEI A,LPTBO
	HRRM A,LPTOP
	AOSA LPTCC
LPTSTP:	CONO LPT,0	;CLEAR PIA
	POP P,A
	JRST LPTBRK

LPTBO:	BLOCK LPTBSZ
LPTBE:

END
